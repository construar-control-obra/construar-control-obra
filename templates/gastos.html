<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gastos</title>
  <style>
    body{font-family:Arial; background:#f6f7fb; margin:0; padding:30px;}
    .wrap{max-width:980px; margin:0 auto;}
    .card{background:#fff; border:1px solid #e6e6e6; border-radius:16px; padding:18px 20px; box-shadow:0 6px 18px rgba(0,0,0,.05);}
    h1{margin:0 0 6px;}
    .muted{color:#777; font-size:13px;}
    label{font-size:13px; display:block; margin-top:10px;}
    input, select{width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-top:6px;}
    .grid{display:grid; grid-template-columns: 160px 200px 1fr 160px; gap:10px;}
    .actions{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;}
    .btn{padding:10px 14px; border-radius:12px; text-decoration:none; border:0; cursor:pointer;}
    .primary{background:#ff7a00; color:#fff;}
    .dark{background:#111; color:#fff;}
    table{width:100%; border-collapse:collapse; margin-top:16px;}
    th,td{border-bottom:1px solid #eee; padding:10px; font-size:14px;}
    th{background:#f1f2f6;}
    .right{text-align:right;}
  </style>
</head>
<body>
<div class="wrap">
<div class="card">

<h1>üí∏ Gastos</h1>
<p class="muted">Registro de gastos por obra.</p>

<form method="get">
  <label>Selecciona obra</label>
  <select name="obra_id" onchange="this.form.submit()">
    {% for o in obras %}
      <option value="{{ o.id }}" {% if obra_sel and o.id == obra_sel.id %}selected{% endif %}>
        {{ o.nombre }}
      </option>
    {% endfor %}
  </select>
</form>

{% if obra_sel %}
<hr style="border:none;border-top:1px solid #eee;margin:14px 0;">

<form method="post">
  <input type="hidden" name="obra_id" value="{{ obra_sel.id }}">

  <div class="grid">
    <div>
      <label>Fecha</label>
      <input type="date" name="fecha" required>
    </div>

    <div>
      <label>Categor√≠a</label>
      <select name="categoria" required>
        <option>Material</option>
        <option>Mano de Obra</option>
        <option>IMSS</option>
        <option>ISR</option>
        <option>Indirectos</option>
        <option>Equipo</option>
        <option>Otros</option>
      </select>
    </div>

    <div>
      <label>Concepto</label>
      <input name="concepto" required>
    </div>

    <div>
      <label>Monto</label>
      <input name="monto" required>
    </div>
  </div>

  <div class="actions">
    <button class="btn primary">Agregar gasto</button>
    <a class="btn dark" href="{{ url_for('home') }}">‚Üê Volver</a>
  </div>
</form>

<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Categor√≠a</th>
      <th>Concepto</th>
      <th class="right">Monto</th>
    </tr>
  </thead>
  <tbody>
    {% for g in gastos %}
    <tr>
      <td>{{ g.fecha }}</td>
      <td>{{ g.categoria }}</td>
      <td>{{ g.concepto }}</td>
      <td class="right">{{ "%.2f"|format(g.monto) }}</td>
    </tr>
    {% else %}
    <tr>
      <td colspan="4" class="muted">A√∫n no hay gastos registrados.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}
<p class="muted">Primero crea una obra.</p>
<a class="btn dark" href="{{ url_for('home') }}">‚Üê Volver</a>
{% endif %}

</div>
</div>
</body>
</html>
